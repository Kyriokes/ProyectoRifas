rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Reglas para "numeros_comprados"
    match /numeros_comprados/{idNumero} {
      allow read: if true; // Cualquier usuario puede leer
      allow create: if request.auth != null; // Solo usuarios autenticados pueden comprar números
      allow update: if request.auth != null && request.auth.uid == resource.data.comprador_id; // Solo el comprador puede actualizar
      allow delete: if false; // Nadie puede eliminar números comprados
    }

    // Reglas para "compradores"
    match /compradores/{idComprador} {
      allow read: if request.auth != null && request.auth.uid == idComprador; // Solo el comprador puede ver sus datos
      allow create: if request.auth != null; // Solo usuarios autenticados pueden registrarse
      allow update: if request.auth != null && request.auth.uid == idComprador; // Solo el comprador puede modificar sus datos
      allow delete: if false; // No se permite eliminar compradores
    }

    // Reglas para "metodos_pago"
    match /metodos_pago/{idMetodo} {
      allow read: if true; // Cualquier usuario puede ver los métodos de pago
      allow create, update, delete: if request.auth != null && request.auth.token.admin == true; // Solo admin puede modificar
    }

    // Reglas para "rifas"
    match /rifas/{idRifa} {
      allow read: if true; // Cualquier usuario puede ver las rifas
      allow create, update, delete: if request.auth != null && request.auth.token.admin == true; // Solo admin puede modificar
    }

    // Reglas para "usuarios" (Admin)
    match /usuarios/{idUsuario} {
      allow read, create, update, delete: if request.auth != null && request.auth.token.admin == true; // Solo admin puede gestionar usuarios
    }
  }
}